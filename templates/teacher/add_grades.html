{% extends 'base.html' %} {% block title %}Add Grades - {{ subject.name }}{% endblock %} {% block
content %}
<div class="container-fluid">
  <!-- Page Header -->
  <div class="page-header">
    <div class="row align-items-center">
      <div class="col">
        <h2><i class="bi bi-clipboard-plus me-2"></i>Grade Management</h2>
        <p>{{ subject.name }} - {{ subject.class_name|replace_section }}</p>
      </div>
      <div class="col-auto">
        <a href="{{ url_for('teacher_grades') }}" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left me-1"></i>Back
        </a>
      </div>
    </div>
  </div>

  {% if not components %}
  <!-- No Grade Structure -->
  <div class="card">
    <div class="card-body text-center py-5">
      <i class="bi bi-clipboard-x text-muted" style="font-size: 4rem"></i>
      <h4 class="mt-3">No Grade Distribution Defined</h4>
      <p class="text-muted">
        The admin has not set up the grade distribution for this subject yet.<br />Please contact
        the admin to define the grading structure.
      </p>
      <a href="{{ url_for('teacher_grades') }}" class="btn btn-primary mt-3">
        <i class="bi bi-arrow-left me-1"></i>Back to Grades
      </a>
    </div>
  </div>
  {% else %}

  <div class="row">
    <!-- Grade Distribution Structure (Left Side) -->
    <div class="col-lg-4">
      <div class="card sticky-top" style="top: 20px">
        <div class="card-header bg-navy text-white">
          <i class="bi bi-diagram-3 me-2"></i><strong>Grade Distribution</strong>
        </div>
        <div class="card-body p-0">
          <div class="list-group list-group-flush">
            {% set ns = namespace(seen_types=[], total_weight=0) %} {% for component in components
            %} {% if component.component_type not in ns.seen_types %} {% set _ =
            ns.seen_types.append(component.component_type) %} {% set type = component.component_type
            %} {% set items = components | selectattr('component_type', 'equalto', type) | list %}
            {% set type_weight = items | sum(attribute='weight_percentage') %} {% set
            ns.total_weight = ns.total_weight + type_weight %}

            <!-- Category Header -->
            <div class="list-group-item bg-light border-0 py-2">
              <div class="d-flex justify-content-between align-items-center">
                <strong class="text-uppercase text-navy" style="font-size: 0.9rem">
                  {{ type|replace('_', ' ') }}
                </strong>
                <span class="badge bg-dark">{{ type_weight|round(1) }}%</span>
              </div>
            </div>

            <!-- Category Items -->
            {% for item in items %}
            <div class="list-group-item border-0 py-2 ps-4">
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted" style="font-size: 0.85rem">{{ item.component_name }}</span>
                <div>
                  <span class="text-muted me-2" style="font-size: 0.75rem"
                    >{{ item.weight_percentage|round(1) }}%</span
                  >
                  <span class="badge bg-secondary" style="font-size: 0.7rem"
                    >Max: {{ item.max_score }}</span
                  >
                </div>
              </div>
            </div>
            {% endfor %} {% endif %} {% endfor %}

            <!-- Total -->
            <div class="list-group-item bg-light border-0 py-3">
              <div class="d-flex justify-content-between align-items-center">
                <strong>TOTAL</strong>
                <span
                  class="badge {{ 'bg-success' if ns.total_weight == 100 else 'bg-warning text-dark' }} fs-6"
                >
                  {{ ns.total_weight|round(1) }}%
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Student List (Right Side) -->
    <div class="col-lg-8">
      <div class="card">
        <div class="card-header">
          <i class="bi bi-people me-2"></i><strong>Students - Click to Add Grades</strong>
          <span class="badge bg-navy ms-2">{{ students|length }} Students</span>
        </div>
        <div class="card-body p-0">
          {% if students %}
          <div class="list-group list-group-flush">
            {% for student in students %}
            <a
              href="#"
              class="list-group-item list-group-item-action py-3"
              data-student-id="{{ student.id }}"
              onclick="openGradeModal({{ student.id }}, '{{ student.full_name }}', '{{ student.student_number or '' }}'); return false;"
            >
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div class="flex-grow-1">
                  <strong class="d-block">{{ student.full_name }}</strong>
                  <small class="text-muted">
                    <i class="bi bi-person-badge me-1"></i>{{ student.student_number or 'No ID' }}
                  </small>
                </div>
                <div class="text-end d-flex align-items-center gap-2">
                  <span
                    class="badge bg-secondary graded-badge d-none"
                    data-student-id="{{ student.id }}"
                  >
                    <i class="bi bi-check-circle me-1"></i>Complete
                  </span>
                  <span
                    class="badge bg-info text-white partial-badge d-none"
                    data-student-id="{{ student.id }}"
                  >
                    <span class="score-sum">0</span>/100 (<span class="graded-count">0</span>/<span
                      class="total-count"
                      >0</span
                    >)
                  </span>
                  <i class="bi bi-chevron-right text-muted"></i>
                </div>
              </div>
              <!-- Individual Progress Bar -->
              <div class="progress" style="height: 6px" data-student-id="{{ student.id }}">
                <div
                  class="progress-bar bg-success"
                  role="progressbar"
                  style="width: 0%"
                  data-student-id="{{ student.id }}"
                ></div>
              </div>
            </a>
            {% endfor %}
          </div>
          {% else %}
          <div class="text-center py-5">
            <i class="bi bi-people text-muted" style="font-size: 4rem"></i>
            <h5 class="mt-3">No Students Enrolled</h5>
            <p class="text-muted">There are no students in this class yet.</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% endif %}
</div>

<!-- Grade Entry Modal -->
<div class="modal fade" id="gradeModal" tabindex="-1" data-bs-backdrop="static">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-navy text-white">
        <div>
          <h5 class="modal-title">
            <i class="bi bi-clipboard-check me-2"></i>
            <span id="modalStudentName">Student Name</span>
          </h5>
          <small id="modalStudentNumber" class="d-block mt-1 opacity-75"></small>
        </div>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <form
        method="POST"
        action="{{ url_for('teacher_add_grades', subject_id=subject.id) }}"
        id="gradeForm"
      >
        <input type="hidden" name="student_id" id="studentIdInput" />
        <input type="hidden" name="date" id="dateInput" value="{{ today if today else '' }}" />

        <div class="modal-body">
          <div class="alert alert-info" id="modalInfoAlert">
            <i class="bi bi-info-circle me-2"></i>
            <span id="modalInfoText"
              >Enter scores for each component. Leave blank to skip. Click Save All when done.</span
            >
          </div>

          <div id="loadingIndicator" class="text-center py-3 d-none">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted">Loading existing grades...</p>
          </div>

          <!-- Grade Components List -->
          <div class="table-responsive">
            <table class="table table-bordered table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th style="width: 50%">Component</th>
                  <th class="text-center" style="width: 20%">Max Score</th>
                  <th class="text-center" style="width: 30%">Student Score</th>
                </tr>
              </thead>
              <tbody id="gradeComponentsList">
                {% set ns = namespace(seen_types=[]) %} {% for component in components %} {% if
                component.component_type not in ns.seen_types %} {% set _ =
                ns.seen_types.append(component.component_type) %} {% set type =
                component.component_type %} {% set items = components | selectattr('component_type',
                'equalto', type) | list %} {% set type_weight = items |
                sum(attribute='weight_percentage') %}

                <!-- Category Header Row -->
                <tr class="table-secondary">
                  <td colspan="3" class="d-flex justify-content-between align-items-center">
                    <div>
                      <strong class="text-uppercase">{{ type|replace('_', ' ') }}</strong>
                      <span class="badge bg-dark ms-2">{{ type_weight|round(1) }}%</span>
                    </div>
                    <div>
                      <span
                        class="badge bg-info text-white category-total"
                        data-category="{{ type }}"
                        data-student-id=""
                      >
                        <i class="bi bi-calculator me-1"></i>
                        Avg: <span class="current-total">-</span>/<span class="max-total">-</span>
                      </span>
                    </div>
                  </td>
                </tr>

                <!-- Category Items -->
                {% for item in items %}
                <tr>
                  <td class="ps-4">
                    {{ item.component_name }}
                    <small class="text-muted d-block"
                      >{{ item.weight_percentage|round(1) }}% of total</small
                    >
                  </td>
                  <td class="text-center align-middle">
                    <strong>{{ item.max_score }}</strong>
                  </td>
                  <td class="text-center align-middle">
                    <input
                      type="number"
                      name="component_{{ item.id }}"
                      class="form-control text-center grade-input"
                      data-component-id="{{ item.id }}"
                      min="0"
                      max="{{ item.max_score }}"
                      step="0.5"
                      placeholder="-"
                      style="max-width: 100px; margin: 0 auto"
                      oninput="validateScoreInput(this)"
                      onblur="validateScoreInput(this)"
                    />
                  </td>
                </tr>
                {% endfor %} {% endif %} {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-circle me-1"></i>Cancel
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-save me-1"></i>Save All Grades
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  let currentModal = null;

  // Validate score input - prevent values > max
  function validateScoreInput(input) {
    const max = parseFloat(input.max);
    const min = parseFloat(input.min) || 0;
    let value = parseFloat(input.value);

    // Remove any non-numeric except decimal point
    if (input.value !== '' && isNaN(value)) {
      input.value = '';
      return;
    }

    if (input.value !== '') {
      // Check if value exceeds max
      if (value > max) {
        console.log(`Value ${value} exceeds max ${max}, setting to ${max}`);
        input.value = max;
        input.style.backgroundColor = '#fff3cd'; // Yellow warning

        // Show brief warning
        input.title = `Maximum score is ${max}`;
        setTimeout(() => {
          input.style.backgroundColor = '';
        }, 1000);
      }
      // Check if value is below min
      else if (value < min) {
        console.log(`Value ${value} below min ${min}, setting to ${min}`);
        input.value = min;
        input.style.backgroundColor = '#fff3cd';
        setTimeout(() => {
          input.style.backgroundColor = '';
        }, 1000);
      }
      // Valid value
      else {
        input.style.backgroundColor = '';
      }
    }

    // Update category totals
    updateCategoryTotals();
  }

  function openGradeModal(studentId, studentName, studentNumber) {
    console.log('\n========================================');
    console.log('OPENING MODAL FOR STUDENT:', studentId);
    console.log('========================================');

    // Set student info
    document.getElementById('studentIdInput').value = studentId;
    document.getElementById('modalStudentName').textContent = studentName;
    document.getElementById('modalStudentNumber').textContent = studentNumber
      ? 'ID: ' + studentNumber
      : '';

    // Store student ID in category totals for later calculation
    document.querySelectorAll('.category-total').forEach(el => {
      el.dataset.studentId = studentId;
    });

    // Clear all inputs first and log each one
    console.log('Clearing all inputs...');
    const inputs = document.querySelectorAll('.grade-input');
    console.log(`Found ${inputs.length} input fields`);
    inputs.forEach((input, index) => {
      console.log(`  Input ${index + 1}: name=${input.name}, id=${input.dataset.componentId}`);
      input.value = ''; // Clear value
      input.style.backgroundColor = ''; // Reset background
    });

    // Show modal first
    currentModal = new bootstrap.Modal(document.getElementById('gradeModal'));
    currentModal.show();

    // Show loading indicator
    const loadingIndicator = document.getElementById('loadingIndicator');
    const modalInfoAlert = document.getElementById('modalInfoAlert');
    if (loadingIndicator) loadingIndicator.classList.remove('d-none');
    if (modalInfoAlert) modalInfoAlert.classList.add('d-none');

    // Load existing grades AFTER modal is shown
    setTimeout(() => {
      const url = `/teacher/grades/student/${studentId}/subject/{{ subject.id }}`;
      console.log('\n--- FETCHING GRADES ---');
      console.log('URL:', url);

      fetch(url)
        .then(response => {
          console.log('Response received, status:', response.status);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          console.log('\n=== GRADES DATA RECEIVED ===');
          console.log('Full response:', JSON.stringify(data, null, 2));
          console.log('Success:', data.success);
          console.log('Number of grades:', data.grades ? data.grades.length : 0);

          // Hide loading, show info
          if (loadingIndicator) loadingIndicator.classList.add('d-none');
          if (modalInfoAlert) modalInfoAlert.classList.remove('d-none');

          if (data.success && data.grades && data.grades.length > 0) {
            console.log(`\n--- FILLING ${data.grades.length} GRADES ---`);

            let successCount = 0;
            let failCount = 0;

            data.grades.forEach((grade, index) => {
              console.log(`\nGrade ${index + 1}:`);
              console.log('  component_id:', grade.component_id);
              console.log('  score:', grade.score);
              console.log('  component_name:', grade.component_name);

              // Try multiple selectors
              const inputName = `component_${grade.component_id}`;
              const input1 = document.querySelector(`input[name="${inputName}"]`);
              const input2 = document.querySelector(`input[data-component-id="${grade.component_id}"]`);
              const input3 = document.querySelector(`.grade-input[name="${inputName}"]`);

              console.log('  Selector results:');
              console.log('    by name:', input1 ? 'FOUND' : 'NOT FOUND');
              console.log('    by data-id:', input2 ? 'FOUND' : 'NOT FOUND');
              console.log('    by class+name:', input3 ? 'FOUND' : 'NOT FOUND');

              const input = input1 || input2 || input3;

              if (input) {
                console.log(`  ✓ Setting value to: ${grade.score}`);
                input.value = grade.score;
                input.style.backgroundColor = '#d4edda'; // Light green background
                setTimeout(() => {
                  console.log(`  Verify: input.value is now "${input.value}"`);
                }, 50);
                successCount++;
              } else {
                console.log(`  ✗ INPUT NOT FOUND for component_${grade.component_id}`);
                failCount++;
              }
            });

            console.log(`\n--- FILL COMPLETE ---`);
            console.log(`Success: ${successCount}, Failed: ${failCount}`);

            // Update category totals
            setTimeout(() => {
              updateCategoryTotals();
            }, 100);

            // Show success message
            const infoText = document.getElementById('modalInfoText');
            if (infoText) {
              infoText.innerHTML = `<i class="bi bi-check-circle text-success me-2"></i>Loaded ${successCount} existing grade(s). Edit and save to update.`;
            }
          } else {
            console.log('\n--- NO EXISTING GRADES ---');
            const infoText = document.getElementById('modalInfoText');
            if (infoText) {
              infoText.innerHTML = '<i class="bi bi-info-circle me-2"></i>No existing grades. Enter new scores below.';
            }
          }

          console.log('========================================\n');
        })
        .catch(error => {
          console.error('\n!!! ERROR LOADING GRADES !!!', error);
          if (loadingIndicator) loadingIndicator.classList.add('d-none');
          if (modalInfoAlert) {
            modalInfoAlert.classList.remove('d-none', 'alert-info');
            modalInfoAlert.classList.add('alert-danger');
            document.getElementById('modalInfoText').innerHTML = `<i class="bi bi-exclamation-triangle me-2"></i>Error loading grades: ${error.message}`;
          }
        });
    }, 400); // Increased delay to 400ms
  }

  // Form submission
  document.getElementById('gradeForm')?.addEventListener('submit', function (e) {
    e.preventDefault();

    const studentId = document.getElementById('studentIdInput').value;
    const date = document.getElementById('dateInput').value;
    const formData = new FormData();

    formData.append('student_id', studentId);
    formData.append('date', date);

    console.log('=== GRADE FORM SUBMISSION ===');
    console.log('Student ID:', studentId);
    console.log('Date:', date);

    // Collect all component scores
    let hasScore = false;
    document.querySelectorAll('#gradeComponentsList input[type="number"]').forEach((input) => {
      const value = input.value.trim();
      console.log('Checking input:', input.name, '= "' + value + '"');

      // Send if not empty string (allows "0" as valid score)
      if (value !== '') {
        hasScore = true;
        formData.append(input.name, value);
        console.log('Added:', input.name, '=', value);
      } else {
        console.log('Skipped (blank):', input.name);
      }
    });

    console.log('Has score:', hasScore);
    console.log('Form action:', this.action);

    if (!hasScore) {
      alert('Please enter at least one score before saving!');
      return;
    }

    // Log all form data
    console.log('FormData contents:');
    for (let pair of formData.entries()) {
      console.log(pair[0] + ': ' + pair[1]);
    }

    // Submit via fetch
    fetch(this.action, {
      method: 'POST',
      body: formData,
    })
      .then((response) => {
        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers);
        return response.json();
      })
      .then((data) => {
        console.log('=== SERVER RESPONSE ===');
        console.log('Success:', data.success);
        console.log('Message:', data.message);
        console.log('Full response:', JSON.stringify(data));

        if (data.success) {
          // Show success message in modal instead of alert
          showToastMessage(data.message || 'Grades saved successfully!', 'success');

          // Update the student's progress bar WITHOUT closing modal
          const totalComponents = {{ components|length }};
          updateStudentProgress(studentId, totalComponents);

          // Optional: Flash the save button to show success
          const saveBtn = document.querySelector('#gradeForm button[type="submit"]');
          const originalText = saveBtn.innerHTML;
          saveBtn.innerHTML = '<i class="bi bi-check-circle me-1"></i>Saved!';
          saveBtn.classList.add('btn-success');
          saveBtn.classList.remove('btn-primary');
          setTimeout(() => {
            saveBtn.innerHTML = originalText;
            saveBtn.classList.remove('btn-success');
            saveBtn.classList.add('btn-primary');
          }, 2000);
        } else {
          showToastMessage('Error: ' + (data.message || 'Failed to save grades'), 'danger');
        }
      })
      .catch((error) => {
        console.error('Fetch error:', error);
        alert('An error occurred while saving grades: ' + error.message);
      });
  });

  // Check graded status for all students on page load
  document.addEventListener('DOMContentLoaded', function() {
    const totalComponents = {{ components|length }};
    const studentItems = document.querySelectorAll('.list-group-item[data-student-id]');

    console.log('Checking graded status for', studentItems.length, 'students');
    console.log('Total components:', totalComponents);

    studentItems.forEach(item => {
      const studentId = item.dataset.studentId;
      updateStudentProgress(studentId, totalComponents);
    });
  });

  function updateStudentProgress(studentId, totalComponents) {
    fetch(`/teacher/grades/student/${studentId}/subject/{{ subject.id }}`)
      .then(response => response.json())
      .then(data => {
        const gradedCount = data.success && data.grades ? data.grades.length : 0;
        const percentage = totalComponents > 0 ? Math.round((gradedCount / totalComponents) * 100) : 0;

        // Calculate weighted score (based on percentages, total = 100)
        let weightedScore = 0;
        if (data.success && data.grades) {
          data.grades.forEach(grade => {
            const score = parseFloat(grade.score) || 0;
            const maxScore = parseFloat(grade.max_score) || 1;
            const weight = parseFloat(grade.weight_percentage) || 0;
            // Calculate contribution: (score/max_score) * weight_percentage
            const contribution = (score / maxScore) * weight;
            weightedScore += contribution;
          });
        }

        // Round to 2 decimal places
        weightedScore = Math.round(weightedScore * 100) / 100;

        console.log(`Student ${studentId}: ${gradedCount}/${totalComponents} components (${percentage}%) - Score: ${weightedScore}/100`);

        // Update progress bar
        const progressBar = document.querySelector(`.progress-bar[data-student-id="${studentId}"]`);
        if (progressBar) {
          progressBar.style.width = percentage + '%';
        }

        // Update badges
        const completeBadge = document.querySelector(`.graded-badge[data-student-id="${studentId}"]`);
        const partialBadge = document.querySelector(`.partial-badge[data-student-id="${studentId}"]`);

        if (gradedCount === totalComponents && totalComponents > 0) {
          // 100% complete - show score in complete badge
          if (completeBadge) {
            completeBadge.classList.remove('d-none', 'bg-secondary');
            completeBadge.classList.add('bg-success');
            completeBadge.innerHTML = `<i class="bi bi-check-circle me-1"></i>${weightedScore}/100`;
          }
          if (partialBadge) {
            partialBadge.classList.add('d-none');
          }
        } else if (gradedCount > 0) {
          // Partially complete - show weighted score and component count
          if (completeBadge) {
            completeBadge.classList.add('d-none');
          }
          if (partialBadge) {
            partialBadge.classList.remove('d-none');
            partialBadge.querySelector('.score-sum').textContent = weightedScore;
            partialBadge.querySelector('.graded-count').textContent = gradedCount;
            partialBadge.querySelector('.total-count').textContent = totalComponents;
          }
        } else {
          // Not started
          if (completeBadge) {
            completeBadge.classList.add('d-none');
          }
          if (partialBadge) {
            partialBadge.classList.add('d-none');
          }
        }
      })
      .catch(error => console.error(`Error checking grades for student ${studentId}:`, error));
  }

  // Calculate and display category averages
  function updateCategoryTotals() {
    console.log('Updating category averages...');
    const categories = {};

    // Group inputs by category
    document.querySelectorAll('#gradeComponentsList input[type="number"]').forEach(input => {
      const row = input.closest('tr');
      const prevHeader = row.previousElementSibling;

      // Find the category by looking backwards for table-secondary row
      let categoryRow = row;
      while (categoryRow && !categoryRow.classList.contains('table-secondary')) {
        categoryRow = categoryRow.previousElementSibling;
      }

      if (categoryRow) {
        const categoryBadge = categoryRow.querySelector('.category-total');
        if (categoryBadge) {
          const category = categoryBadge.dataset.category;
          if (!categories[category]) {
            categories[category] = { currentSum: 0, maxSum: 0, count: 0, gradedCount: 0 };
          }

          const maxScore = parseFloat(input.max) || 0;
          const currentScore = parseFloat(input.value) || 0;

          categories[category].maxSum += maxScore;
          categories[category].count++;

          if (input.value !== '') { // Only count if value is entered
            categories[category].currentSum += currentScore;
            categories[category].gradedCount++;
          }
        }
      }
    });

    // Update badges with averages
    Object.keys(categories).forEach(category => {
      const badge = document.querySelector(`.category-total[data-category="${category}"]`);
      if (badge) {
        const data = categories[category];

        // Calculate averages
        const avgCurrent = data.gradedCount > 0 ? (data.currentSum / data.gradedCount) : 0;
        const avgMax = data.count > 0 ? (data.maxSum / data.count) : 0;

        badge.querySelector('.current-total').textContent = avgCurrent.toFixed(1);
        badge.querySelector('.max-total').textContent = avgMax.toFixed(1);
        console.log(`Category ${category}: Avg ${avgCurrent.toFixed(1)}/${avgMax.toFixed(1)} (${data.gradedCount}/${data.count} graded)`);
      }
    });
  }

  // Update totals when scores change
  document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('gradeComponentsList')?.addEventListener('input', function(e) {
      if (e.target.type === 'number') {
        updateCategoryTotals();
      }
    });
  });

  // ==================== TOAST NOTIFICATION SYSTEM ====================
  let toastContainer = null;

  function showToastMessage(message, type = 'info') {
    // Create toast container if it doesn't exist
    if (!toastContainer) {
      toastContainer = document.createElement('div');
      toastContainer.id = 'toastContainer';
      toastContainer.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999;';
      document.body.appendChild(toastContainer);
    }

    // Create toast
    const toast = document.createElement('div');
    toast.className = `alert alert-${type} alert-dismissible fade show`;
    toast.style.cssText = 'min-width: 250px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);';
    toast.innerHTML = `
      ${message}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;

    toastContainer.appendChild(toast);

    // Auto-dismiss after 3 seconds
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 150);
    }, 3000);
  }

  window.showToastMessage = showToastMessage;
</script>

<style>
  .list-group-item-action:hover {
    background-color: #f8f9fa;
    cursor: pointer;
  }

  .list-group-item-success {
    background-color: #d4edda !important;
    border-color: #c3e6cb !important;
  }

  .table-secondary {
    background-color: #e9ecef !important;
  }

  .modal-body {
    max-height: 70vh;
  }

  /* Individual progress bars */
  .progress {
    background-color: #e9ecef;
    border-radius: 3px;
  }

  .progress-bar {
    transition: width 0.6s ease;
  }

  /* Badge styling */
  .graded-badge,
  .partial-badge {
    font-size: 0.75rem;
    transition: all 0.3s ease;
  }

  /* List item styling */
  .list-group-item[data-student-id] {
    transition: all 0.2s ease;
  }

  .list-group-item[data-student-id]:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transform: translateX(2px);
  }

  @media (max-width: 991px) {
    .sticky-top {
      position: relative !important;
    }
  }
</style>

{% endblock %}
