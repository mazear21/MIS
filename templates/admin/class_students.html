{% extends 'base.html' %} {% block title %}Semester {{ class_info.semester }} - Class {{
class_info.section }}{% endblock %} {% block content %}
<div class="container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="row align-items-center">
      <div class="col">
        <h2>
          {% if class_info.shift == 'morning' %}
          <i class="bi bi-sun text-warning me-2"></i>
          {% else %}
          <i class="bi bi-moon-stars text-primary me-2"></i>
          {% endif %} Semester {{ class_info.semester }} - Class {{ class_info.section }}
        </h2>
        <p class="mb-0">
          <span class="badge bg-{{ 'primary' if class_info.year == 1 else 'success' }} me-2">
            Year {{ class_info.year }}
          </span>
          <span class="badge bg-info me-2"> Semester {{ class_info.semester }} </span>
          <span
            class="badge bg-{{ 'warning text-dark' if class_info.shift == 'morning' else 'dark' }} me-2"
          >
            {{ class_info.shift|title }} Shift
          </span>
          <span class="badge bg-navy">{{ students|length }} Students</span>
        </p>
      </div>
      <div class="col-auto d-flex gap-2">
        <button
          type="button"
          class="btn btn-outline-dark"
          onclick="printClassList()"
          title="Print class list"
        >
          <i class="bi bi-printer me-1"></i>Print
        </button>
        <a href="{{ url_for('admin_add_student') }}" class="btn btn-primary">
          <i class="bi bi-person-plus me-1"></i>Add Student
        </a>
        <a href="{{ url_for('admin_classes') }}" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left me-1"></i>Back
        </a>
      </div>
    </div>
  </div>

  <!-- Students Table -->
  <div class="card">
    <div class="card-header"><i class="bi bi-people me-2"></i>Enrolled Students</div>
    <div class="card-body">
      {% if students %}
      <div class="mb-3">
        <span class="badge bg-navy fs-6">Total Students: {{ students|length }}</span>
      </div>
      <div class="table-responsive">
        <table class="table table-hover" id="studentsTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Student Number</th>
              <th>Full Name</th>
              <th>Username</th>
              <th>Email</th>
              <th>Phone</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
            <tr>
              <td>{{ loop.index }}</td>
              <td><strong>{{ student.student_number or '-' }}</strong></td>
              <td>{{ student.full_name }}</td>
              <td>{{ student.username }}</td>
              <td>{{ student.email or '-' }}</td>
              <td>{{ student.phone or '-' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center py-5">
        <i class="bi bi-people text-muted" style="font-size: 4rem"></i>
        <h5 class="mt-3">No Students in This Class</h5>
        <p class="text-muted">Add students and assign them to this class.</p>
        <a href="{{ url_for('admin_add_student') }}" class="btn btn-primary">
          <i class="bi bi-person-plus me-1"></i>Add Student
        </a>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  function printClassList() {
    const rows = document.querySelectorAll('#studentsTable tbody tr');
    const count = rows.length;
    const semester = '{{ class_info.semester }}';
    const section = '{{ class_info.section }}';
    const shift = '{{ class_info.shift|title }}';
    const year = '{{ class_info.year }}';
    const date = new Date().toLocaleDateString('en-GB', {
      day: '2-digit',
      month: 'long',
      year: 'numeric',
    });

    let tableRows = '';
    rows.forEach((row, i) => {
      const cells = row.querySelectorAll('td');
      tableRows += `
      <tr>
        <td style="padding:10px 14px;border-bottom:1px solid #e0e0e0;color:#666;width:40px;text-align:center;">${cells[0].textContent}</td>
        <td style="padding:10px 14px;border-bottom:1px solid #e0e0e0;font-family:'Courier New',monospace;font-weight:600;letter-spacing:0.5px;">${cells[1].textContent.trim()}</td>
        <td style="padding:10px 14px;border-bottom:1px solid #e0e0e0;font-weight:500;">${cells[2].textContent.trim()}</td>
        <td style="padding:10px 14px;border-bottom:1px solid #e0e0e0;color:#555;">${cells[4].textContent.trim()}</td>
        <td style="padding:10px 14px;border-bottom:1px solid #e0e0e0;color:#555;">${cells[5].textContent.trim()}</td>
      </tr>`;
    });

    const win = window.open('', '_blank');
    win.document.write(`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Class List - Semester ${semester} Class ${section}</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Inter',sans-serif; color:#1a1a1a; padding:0; background:#fff; }
  
  .page { width:100%; max-width:800px; margin:0 auto; padding:40px 50px; }
  
  /* Header */
  .header { border-bottom:2px solid #1a1a1a; padding-bottom:20px; margin-bottom:8px; }
  .header-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:12px; }
  .org-name { font-size:11px; text-transform:uppercase; letter-spacing:3px; color:#888; font-weight:500; }
  .doc-date { font-size:11px; color:#888; text-align:right; line-height:1.6; }
  .title { font-size:22px; font-weight:700; letter-spacing:-0.5px; margin-bottom:4px; }
  .subtitle { font-size:13px; color:#555; font-weight:400; }
  
  /* Meta strip */
  .meta { display:flex; gap:24px; padding:12px 0; border-bottom:1px solid #e0e0e0; margin-bottom:24px; }
  .meta-item { font-size:11px; text-transform:uppercase; letter-spacing:1.5px; color:#777; }
  .meta-item strong { color:#1a1a1a; font-weight:600; display:block; font-size:13px; text-transform:none; letter-spacing:0; margin-top:2px; }
  
  /* Table */
  table { width:100%; border-collapse:collapse; }
  thead tr { border-bottom:2px solid #1a1a1a; }
  thead th { padding:10px 14px; font-size:10px; text-transform:uppercase; letter-spacing:1.5px; color:#555; font-weight:600; text-align:left; }
  tbody tr:last-child td { border-bottom:2px solid #1a1a1a; }
  tbody tr:nth-child(even) { background:#fafafa; }
  
  /* Footer */
  .footer { margin-top:30px; padding-top:16px; border-top:1px solid #e0e0e0; display:flex; justify-content:space-between; }
  .footer span { font-size:10px; color:#aaa; letter-spacing:0.5px; }
  
  @media print {
    body { padding:0; }
    .page { padding:20px 0; }
    tbody tr:nth-child(even) { background:#fafafa !important; -webkit-print-color-adjust:exact; print-color-adjust:exact; }
  }
</style></head>
<body>
<div class="page">
  <div class="header">
    <div class="header-top">
      <div>
        <div class="org-name">Erbil Polytechnic University</div>
        <div class="org-name" style="margin-top:2px;">Management Information Systems</div>
      </div>
      <div class="doc-date">
        ${date}<br>Official Record
      </div>
    </div>
    <div class="title">Class Roster</div>
    <div class="subtitle">Semester ${semester} &mdash; Section ${section} &mdash; ${shift} Shift</div>
  </div>
  
  <div class="meta">
    <div class="meta-item">Academic Year<strong>Year ${year}</strong></div>
    <div class="meta-item">Semester<strong>Semester ${semester}</strong></div>
    <div class="meta-item">Section<strong>Class ${section}</strong></div>
    <div class="meta-item">Shift<strong>${shift}</strong></div>
    <div class="meta-item">Enrolled<strong>${count} Students</strong></div>
  </div>
  
  <table>
    <thead>
      <tr>
        <th style="width:40px;text-align:center;">#</th>
        <th>Student ID</th>
        <th>Full Name</th>
        <th>Email</th>
        <th>Phone</th>
      </tr>
    </thead>
    <tbody>
      ${tableRows}
    </tbody>
  </table>
  
  <div class="footer">
    <span>EPU \u2014 MIS Department</span>
    <span>Page 1 of 1</span>
    <span>Generated ${date}</span>
  </div>
</div>
<script>setTimeout(()=>{window.print();},500)<\/script>
</body></html>`);
    win.document.close();
  }
</script>
{% endblock %}
